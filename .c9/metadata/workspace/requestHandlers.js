{"filter":false,"title":"requestHandlers.js","tooltip":"/requestHandlers.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":41}},"text":"var querystring = require(\"querystring\");"},{"action":"insertText","range":{"start":{"row":0,"column":41},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":68,"column":0}},"lines":["var fs = require(\"fs\");","var formidable = require(\"formidable\");","","","function start(response, postData) {","  var body = '<html>'+","    '<head>'+","    '<meta http-equiv=\"Content-Type\" '+","    'content=\"text/html; charset=UTF-8\" />'+","    '</head>'+","    '<body>'+","    '<form action=\"/upload\" enctype=\"multipart/form-data\" '+","    'method=\"post\">'+","    '<input type=\"file\" name=\"upload\" multiple=\"multiple\">'+","    '<input type=\"submit\" value=\"Upload file\" />'+","    '</form>'+","    '</body>'+","    '</html>';","","","    response.writeHead(200, {\"Content-Type\": \"text/html\"});","    response.write(body);","    response.end();","}","","function upload(response, request) {","  console.log(\"Request handler 'upload' was called.\");","","  var form = new formidable.IncomingForm();","  console.log(\"about to parse\");","  form.parse(request, function(error, fields, files) {","    console.log(\"parsing done\");","","    /* Possible error on Windows systems:","       tried to rename to an already existing file */","    fs.rename(files.upload.path, \"./tmp/test.jpg\", function(err) {","      if (err) {","        fs.unlink(\"./tmp/test.jpg\");","        fs.rename(files.upload.path, \"./tmp/test.jpg\");","      }","    });","    response.writeHead(200, {\"Content-Type\": \"text/html\"});","    response.write(\"received image:<br/>\");","    response.write(\"<img src='/show' />\");","    response.end();","  });","}","","function show(response) {","  console.log(\"Request handler 'show' was called.\");","  fs.readFile(\"./tmp/test.jpg\", \"binary\", function(error, file) {","    if(error) {","      response.writeHead(500, {\"Content-Type\": \"text/plain\"});","      response.write(error + \"\\n\");","      response.end();","    } else {","      response.writeHead(200, {\"Content-Type\": \"image/jpg\"});","      response.write(file, \"binary\");","      response.end();","    }","  });","}","","","exports.start = start;","exports.upload = upload;","exports.show = show;"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":3,"column":0},"end":{"row":3,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1411015838833,"hash":"9ad910dcefdd06ac181902d98d4c3d7289f082ab"}